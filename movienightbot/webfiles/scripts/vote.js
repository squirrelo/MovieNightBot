Vote={},Vote.shouldRedraw=!1,Vote.totalScore=0,Vote.lastData=null,Vote.segmentColors=["#FF5E71","#A95EFF","#5EA6FF","#5EFFB6","#8E3A3A","#5E6BFF","#EEFF5E","#608E3A","#3B7493","#8D963C","#DEFF5E","#793B91"],Vote.refreshCount=0,Vote.maxRefreshCount=30,Vote.timeoutms=3e4,Vote.Init=function(){window.onresize=Vote.OnResize,this.RequestData()},Vote.RequestData=function(){let t=new XMLHttpRequest;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&Vote.RequestFulfilled(this.responseText)};let e="/json/vote?server="+Utility.GetQueryValue("server");t.open("GET",e,!0),t.send()},Vote.RequestFulfilled=function(t){let e={};try{e=JSON.parse(t)}catch{return}this.lastData=e,this.RenderVoteData();let i=document.querySelector(".movieList");if(i.innerHTML="",null!=this.lastData&&0!=this.lastData.movies.length){for(let t=0;t<this.lastData.movies.length;t++){let e=this.lastData.movies[t],o="#fff";t<this.segmentColors.length&&(o=this.segmentColors[t]);let s=new MovieVote(e,o);s.Init(),i.appendChild(s.domObject)}this.lastData.voter_count<1?document.querySelector("#voteCount").innerHTML="Participants: None":document.querySelector("#voteCount").innerHTML="Participants: "+this.lastData.voter_count,this.refreshCount<this.maxRefreshCount?(setTimeout((function(){Vote.RequestData()}),Vote.timeoutms),this.refreshCount++):document.querySelector("#warning").innerHTML="Automatic refresh timed out, please refresh page."}else i.innerHTML="Nothing right now."},Vote.RenderVoteData=function(){this.shouldRedraw=!0,this.totalScore=0;for(let t=0;t<this.lastData.movies.length;t++)this.totalScore+=this.lastData.movies[t].score},Vote.DrawChart=function(t){if(this.shouldRedraw=!1,t.background("#263D59"),t.noStroke(),null==this.lastData)return t.fill("#fff"),t.textSize(.03*t.width),t.textAlign(t.CENTER),void t.text("No Data Yet",.5*t.width,.5*t.width);if(0==this.lastData.movies.length)return t.fill("#555"),t.circle(.5*t.width,.5*t.height,t.width),t.fill("#fff"),t.textSize(.03*t.width),t.textAlign(t.CENTER),void t.text("No Ongoing Vote",.5*t.width,.5*t.width);if(this.totalScore<=0)return t.fill("#555"),t.circle(.5*t.width,.5*t.height,t.width),t.fill("#fff"),t.textSize(.03*t.width),t.textAlign(t.CENTER),void t.text("No Votes Yet",.5*t.width,.5*t.width);let e=0;for(let i=0;i<this.lastData.movies.length;i++){let o=this.lastData.movies[i];if(0==o.score)continue;let s=o.score/this.totalScore*t.TWO_PI,n=t.color(t.random(255),t.random(255),t.random(255));i<this.segmentColors.length&&(n=t.color(this.segmentColors[i])),t.fill(n),t.arc(.5*t.width,.5*t.width,t.width,t.width,e,e+s),e+=s}e=0;let i=.35;for(let o=0;o<this.lastData.movies.length;o++){let s=this.lastData.movies[o];if(0==s.score)continue;let n=s.score/this.totalScore*t.TWO_PI,a=.5*(e+n-e)+e;t.fill("#000"),t.textSize(.03*t.width),t.textAlign(t.CENTER),t.text(s.title,.5*t.width+t.cos(a)*t.width*i,.5*t.width+t.sin(a)*t.width*i),t.text(s.score,.5*t.width+t.cos(a)*t.width*i*.5,.5*t.width+t.sin(a)*t.width*i*.5),e+=n}},Vote.ShowSuggested=function(){window.location.href="/movies.html?server="+Utility.GetQueryValue("server")+"&view=suggested"},Vote.ShowWatched=function(){window.location.href="/movies.html?server="+Utility.GetQueryValue("server")+"&view=watched"};const p5Setup=t=>{this.canvas=null,t.setup=function(){this.canvas=t.createCanvas(.5*window.innerWidth,.5*window.innerWidth),t.windowResized()},t.draw=function(){Vote.shouldRedraw&&Vote.DrawChart(t)},t.windowResized=function(){let e=window.innerWidth;window.innerHeight<window.innerWidth&&(e=window.innerHeight),e*=.5,t.resizeCanvas(e,e),Vote.shouldRedraw=!0}};function MovieVote(t,e){this.suggestionJSON=t,this.domObject=null,this.baseObj=null,this.Init=function(){this.baseObj=new SuggestedMovie(this.suggestionJSON),this.baseObj.Init(t),this.domObject=this.baseObj.domObject,console.log(this.domObject);let i=this.domObject.querySelector("#data2");i.innerHTML="<h3>Chart Color</h3>",i.style.backgroundColor=e}}canvasEnvironment=new p5(p5Setup,"piechart"),Vote.Init();